<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
  <meta charset="utf-8">
  <meta name="generator" content="quarto-0.9.194">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <title>BATS_Val_57_Exploratory-Analysis - Analysis of UVP data along a transect</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>

  <script src="site_libs/quarto-nav/quarto-nav.js"></script>
  <script src="site_libs/quarto-nav/headroom.min.js"></script>
  <script src="site_libs/clipboard/clipboard.min.js"></script>
  <meta name="quarto:offset" content="./">
  <script src="site_libs/quarto-search/autocomplete.umd.js"></script>
  <script src="site_libs/quarto-search/fuse.min.js"></script>
  <script src="site_libs/quarto-search/quarto-search.js"></script>
  <script src="site_libs/quarto-html/quarto.js"></script>
  <script src="site_libs/quarto-html/popper.min.js"></script>
  <script src="site_libs/quarto-html/tippy.umd.min.js"></script>
  <script src="site_libs/quarto-html/anchor.min.js"></script>
  <link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
  <link id="quarto-text-highlighting-styles" href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet">
  <script src="site_libs/bootstrap/bootstrap.min.js"></script>
  <link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
  <link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet">
  <script id="quarto-search-options" type="application/json">{
    "location": "navbar",
    "copy-button": false,
    "collapse-after": 3,
    "panel-placement": "end",
    "type": "overlay",
    "limit": 20,
    "language": {
      "search-no-results-text": "No results",
      "search-matching-documents-text": "matching documents",
      "search-copy-link-title": "Copy link to search",
      "search-hide-matches-text": "Hide additional matches",
      "search-more-match-text": "more match in this document",
      "search-more-matches-text": "more matches in this document",
      "search-clear-button-title": "Clear",
      "search-detached-cancel-button-title": "Cancel",
      "search-submit-button-title": "Submit"
    }
  }</script>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  <link rel="stylesheet" href="styles.css">
</head>
<body class="fullcontent">
<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">BATS_Val_57_Exploratory-Analysis</span>
  </a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html">Home</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./bv57_exploratory_taxa-diversity.html">Diversity Analysis</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./bv57_exploratory_density.html" aria-current="page">Integrated Abundance Analysis</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./bv57_exploratory_copepod-body-vol.html">Copepod Body Size</a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">
<header id="title-block-header" class="quarto-title-block default">

<div class="quarto-title"><h1 class="title display-7">Analysis of UVP data along a transect</h1></div></header>
<section id="how-does-abundance-change-along-the-transect" class="level1">
<h1>How does abundance change along the transect?</h1>
<section id="we-need-to-load-in-and-parse-through-the-data" class="level3">
<h3 class="anchored" data-anchor-id="we-need-to-load-in-and-parse-through-the-data">1 - We need to load in and parse through the data</h3>
<p>We need to first import the data and select the core information that we need. The UVP project folder has all the casts we want and then some. We only want the BATS Validation cruise - bv57. We’ll need to remove the hs casts.</p>
<section id="setting-up-the-requisites" class="level4">
<h4 class="anchored" data-anchor-id="setting-up-the-requisites">Setting up the requisites</h4>
<div class="cell">

</div>
</section>
<section id="importing-data-and-trimming-list-to-keep-only-bv-casts" class="level4">
<h4 class="anchored" data-anchor-id="importing-data-and-trimming-list-to-keep-only-bv-casts">Importing data and trimming list to keep only bv casts</h4>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>uvp_dat <span class="ot">&lt;-</span> <span class="fu">ecopart_import</span>(<span class="st">"~/BV_transect_export"</span>) <span class="co">#load in initial ecopart object</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># we need to trim out the hs casts</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># One way to do that would be to hard-code indices for those but that's not reliable</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co">#So I'm using regex</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co">#get index of hs data for both par and zoo files</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>hs_index_par <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">"hs"</span>,<span class="fu">names</span>(uvp_dat<span class="sc">$</span>par_files))</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>hs_index_zoo <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">'hs'</span>, <span class="fu">names</span>(uvp_dat<span class="sc">$</span>zoo_files))</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>uvp_dat<span class="sc">$</span>par_files <span class="ot">&lt;-</span> uvp_dat<span class="sc">$</span>par_files[<span class="sc">-</span>hs_index_par]</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>uvp_dat<span class="sc">$</span>zoo_files <span class="ot">&lt;-</span> uvp_dat<span class="sc">$</span>zoo_files[<span class="sc">-</span>hs_index_zoo]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="identifying-the-meta-data" class="level3">
<h3 class="anchored" data-anchor-id="identifying-the-meta-data">2 - Identifying the meta-data</h3>
<p>We want to now get a little idea of the data that we have. The main questions we have are how many locations are at each site, which are day vs night, and how deep does each cast go?</p>
<section id="first-lets-look-at-the-time-of-day-for-these-casts" class="level4">
<h4 class="anchored" data-anchor-id="first-lets-look-at-the-time-of-day-for-these-casts">First, let’s look at the time of day for these casts</h4>
<p>All these data are in the meta file. Something to keep in mind is that UVP time is recorded in UTC - so you need to get sunrise/sunset times from <a href="https://gml.noaa.gov/grad/solcalc/sunrise.html">NOAA’s Solar Calculator</a>. I’m not super precise with it, I just go with the month at longitude.</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># I'm writing a function for myself for later</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>get_time <span class="ot">&lt;-</span> <span class="cf">function</span>(full_date) {</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  time_stamp <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="fu">strsplit</span>(<span class="fu">as.character</span>(full_date),<span class="st">" "</span>),</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>                       <span class="st">`</span><span class="at">[[</span><span class="st">`</span>,<span class="dv">2</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">as.POSIXct</span>(time_stamp, <span class="at">format =</span> <span class="st">'%H:%M:%S'</span>))</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co">#my function above will just get the time and set it to todays date but that is fine</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>uvp_dat<span class="sc">$</span>meta<span class="sc">$</span>time_of_day <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="fu">get_time</span>(uvp_dat<span class="sc">$</span>meta<span class="sc">$</span>sampledate), timeOfDay,<span class="st">'10:18:00'</span>,<span class="st">'21:48:00'</span>,<span class="dv">1</span>) <span class="co">#this will add time of day to our metadata file</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There’s actually very few night casts, let’s just go with the day casts then for this project.</p>
</section>
<section id="now-we-want-to-check-the-max-depth-for-all-our-casts" class="level4">
<h4 class="anchored" data-anchor-id="now-we-want-to-check-the-max-depth-for-all-our-casts">Now we want to check the max-depth for all our casts</h4>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># a quick funciton to find max depth</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>get_max_d <span class="ot">&lt;-</span> <span class="cf">function</span>(zoo_file) {</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  max_d <span class="ot">&lt;-</span> zoo_file<span class="sc">$</span>depth_including_offset[<span class="fu">which.max</span>(zoo_file<span class="sc">$</span>depth_including_offset)]</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(max_d)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>max_d <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="fu">length</span>(uvp_dat<span class="sc">$</span>zoo_files))</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(uvp_dat<span class="sc">$</span>zoo_files)) {</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  max_d[i] <span class="ot">&lt;-</span> <span class="fu">get_max_d</span>(uvp_dat<span class="sc">$</span>zoo_files[[i]])</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>depth_tibble <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">profileid =</span> <span class="fu">names</span>(uvp_dat<span class="sc">$</span>zoo_files),</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>                       <span class="at">max_d =</span> max_d)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>uvp_dat<span class="sc">$</span>meta <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(<span class="fu">merge</span>(uvp_dat<span class="sc">$</span>meta,</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>                                depth_tibble))</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">Profile_id =</span> uvp_dat<span class="sc">$</span>meta<span class="sc">$</span>profileid,</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">lat =</span> uvp_dat<span class="sc">$</span>meta<span class="sc">$</span>latitude,</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">tod =</span> uvp_dat<span class="sc">$</span>meta<span class="sc">$</span>time_of_day,</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">max_d =</span> uvp_dat<span class="sc">$</span>meta<span class="sc">$</span>max_d)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code># A tibble: 21 x 4
   Profile_id   lat tod   max_d
   &lt;chr&gt;      &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt;
 1 bv57c1      30.7 day    499 
 2 bv57c10     26.7 day   1206.
 3 bv57c11     26.7 night 1206.
 4 bv57c12     27.7 day    489 
 5 bv57c13     27.7 day   5422.
 6 bv57c14     29.7 day   4992.
 7 bv57c15     31.7 night 4612.
 8 bv57c16     33.7 day   4830.
 9 bv57c17     35.7 day    502.
10 bv57c18     35.7 day   4366.
# ... with 11 more rows</code></pre>
</div>
</div>
<p>Looking at this data, we have several casts going to at least 500m, some going to 1200m, and several going to 5000m. So what we can do is look at four ocean regions - epipelagic (0-200), upper mesopelagic (200-500), lower mesopelagic (500 - 1200), bathypelagic (1200 - 4000).</p>
<p>Next steps will be to calculate concentration for each profile, then look at integrated densities. But first we need to rename our data to core taxonomic groups.</p>
</section>
<section id="first-lets-look-at-which-taxonomic-categories-we-have" class="level4">
<h4 class="anchored" data-anchor-id="first-lets-look-at-which-taxonomic-categories-we-have">First let’s look at which taxonomic categories we have:</h4>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>list_taxa <span class="ot">&lt;-</span> <span class="cf">function</span>(uvp_dat) {</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  tdf <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, uvp_dat<span class="sc">$</span>zoo_files)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(tdf<span class="sc">$</span>name)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>} <span class="co">#should add name column option</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(<span class="fu">names</span>(<span class="fu">table</span>(<span class="fu">list_taxa</span>(uvp_dat))),</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>       <span class="fu">table</span>(<span class="fu">list_taxa</span>(uvp_dat)) <span class="sc">/</span> <span class="fu">length</span>(<span class="fu">list_taxa</span>(uvp_dat)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>                        [,1]                      [,2]                  
Acantharea              "Acantharea"              "0.00176489464113809" 
Actinopterygii          "Actinopterygii"          "0.00032088993475238" 
Alciopidae              "Alciopidae"              "0.00016044496737619" 
Amphipoda               "Amphipoda"               "0.000106963311584127"
Annelida                "Annelida"                "5.34816557920633e-05"
Aulacantha              "Aulacantha"              "0.00304845438014761" 
Aulacanthidae           "Aulacanthidae"           "0.00534816557920633" 
Aulographis             "Aulographis"             "0.00016044496737619" 
Aulosphaeridae          "Aulosphaeridae"          "0.00235319285485079" 
badfocus&lt;artefact       "badfocus&lt;artefact"       "0.169643812172425"   
badfocus&lt;Copepoda       "badfocus&lt;Copepoda"       "0.000106963311584127"
bubble                  "bubble"                  "0.0251363782222698"  
Calanoida               "Calanoida"               "0.00165793132955396" 
Castanellidae           "Castanellidae"           "0.000588298213712697"
Chaetognatha            "Chaetognatha"            "0.00139052305059365" 
Cnidaria&lt;Hydrozoa       "Cnidaria&lt;Hydrozoa"       "0.0010161514600492"  
Cnidaria&lt;Metazoa        "Cnidaria&lt;Metazoa"        "0.00123007808321746" 
Coelodendridae          "Coelodendridae"          "0.000695261525296823"
Coelodendrum            "Coelodendrum"            "0.00032088993475238" 
Coelographis            "Coelographis"            "0.000534816557920633"
Collodaria              "Collodaria"              "0.00096266980425714" 
colonial&lt;Aulosphaeridae "colonial&lt;Aulosphaeridae" "5.34816557920633e-05"
colonial&lt;Rhizaria       "colonial&lt;Rhizaria"       "0.00256711947801904" 
Copepoda                "Copepoda"                "0.0215531072842015"  
Crustacea               "Crustacea"               "0.00064177986950476" 
Ctenophora X            "Ctenophora X"            "0.000106963311584127"
Ctenophora&lt;Metazoa      "Ctenophora&lt;Metazoa"      "0.000106963311584127"
darksphere              "darksphere"              "0.115787784789817"   
Decapoda                "Decapoda"                "5.34816557920633e-05"
detritus                "detritus"                "0.140763718044711"   
Diatoma                 "Diatoma"                 "5.34816557920633e-05"
duplicate               "duplicate"               "0.000106963311584127"
Echinodermata           "Echinodermata"           "5.34816557920633e-05"
Eucalanidae             "Eucalanidae"             "0.000695261525296823"
Eumalacostraca          "Eumalacostraca"          "0.00112311477163333" 
feces                   "feces"                   "0.0182907262808857"  
fiber&lt;detritus          "fiber&lt;detritus"          "0.0403786501230078"  
Foraminifera            "Foraminifera"            "0.00112311477163333" 
house                   "house"                   "0.00310193603593967" 
Hydrozoa                "Hydrozoa"                "0.00048133490212857" 
light&lt;detritus          "light&lt;detritus"          "0.117392234463579"   
living&lt;                 "living&lt;"                 "0.00438549577494919" 
Medusettidae            "Medusettidae"            "0.000106963311584127"
Ostracoda               "Ostracoda"               "0.00117659642742539" 
other&lt;living            "other&lt;living"            "0.00080222483688095" 
Phaeodaria              "Phaeodaria"              "0.000855706492673013"
Polychaeta              "Polychaeta"              "5.34816557920633e-05"
Pteropoda               "Pteropoda"               "0.00016044496737619" 
puff                    "puff"                    "0.0326772916889507"  
Rhizaria                "Rhizaria"                "0.00208578457589047" 
Rhizaria X              "Rhizaria X"              "0.00149748636217777" 
Salpidae                "Salpidae"                "0.000267408278960317"
Siphonophorae           "Siphonophorae"           "0.000695261525296823"
solitaryblack           "solitaryblack"           "0.000106963311584127"
solitaryglobule         "solitaryglobule"         "0.00272756444539523" 
temp circle             "temp circle"             "0.00475986736549364" 
Tomopteridae            "Tomopteridae"            "0.000588298213712697"
tuff                    "tuff"                    "0.265910792598139"   
Tuscaroridae            "Tuscaroridae"            "0.000106963311584127"</code></pre>
</div>
</div>
<p>From this, let’s look at: Rhizaria, Copepods, Trichodesmium, Chaetognath, Annelida, Eumalacostraca. One issue we want to correct is that darksphere is classified as living and we want to change that to be non-living</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'living'</span>, <span class="st">"Rhizaria"</span>,<span class="st">"Copepoda"</span>,<span class="st">"Trichodesmium"</span>,</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Chaetognatha"</span>,<span class="st">'Annelida'</span>,<span class="st">"Eumalacostraca"</span>,<span class="st">'not-living'</span>,<span class="st">'darksphere'</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>uvp_dat <span class="ot">&lt;-</span> uvp_dat <span class="sc">%&gt;%</span> </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_zoo</span>(names_to, <span class="st">'name'</span>, names, <span class="at">suppress_print =</span> T)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>darksphere_switch <span class="ot">&lt;-</span> <span class="cf">function</span>(zoo_file) {</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  new_name <span class="ot">&lt;-</span> zoo_file<span class="sc">$</span>name</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  new_name[<span class="fu">which</span>(new_name <span class="sc">==</span> <span class="st">'darksphere'</span>)] <span class="ot">&lt;-</span> <span class="st">'not-living'</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(new_name)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>uvp_dat <span class="ot">&lt;-</span> <span class="fu">add_zoo</span>(uvp_dat, darksphere_switch, <span class="st">'name'</span>)</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="fu">names</span>(<span class="fu">table</span>(<span class="fu">list_taxa</span>(uvp_dat))),</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>       <span class="fu">table</span>(<span class="fu">list_taxa</span>(uvp_dat)) <span class="sc">/</span> <span class="fu">length</span>(<span class="fu">list_taxa</span>(uvp_dat)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code># A tibble: 8 x 2
  `names(table(list_taxa(uvp_dat)))` `table(list_taxa(uvp_dat))/length(list_ta~`
  &lt;chr&gt;                              &lt;table&gt;                                    
1 Annelida                           0.0008557065                               
2 Chaetognatha                       0.0013905231                               
3 Copepoda                           0.0240132635                               
4 Eumalacostraca                     0.0012835597                               
5 living                             0.0194673227                               
6 not-living                         0.6273933041                               
7 Rhizaria                           0.0270082362                               
8 Trichodesmium                      0.2985880843                               </code></pre>
</div>
</div>
</section>
</section>
<section id="calculating-the-concentration-integrating" class="level3">
<h3 class="anchored" data-anchor-id="calculating-the-concentration-integrating">3 - Calculating the concentration &amp; Integrating</h3>
<p>We now want to calculate the concentration of different taxa. We’ll do this in 20m bins.</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>conc_list <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">'list'</span>,<span class="fu">length</span>(uvp_dat<span class="sc">$</span>zoo_files))</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(conc_list) <span class="ot">&lt;-</span> <span class="fu">names</span>(uvp_dat<span class="sc">$</span>zoo_files)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(conc_list)) {</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  conc_list[[i]] <span class="ot">&lt;-</span> <span class="fu">uvp_conc</span>(uvp_dat,<span class="fu">names</span>(conc_list)[i],<span class="fu">seq</span>(<span class="dv">0</span>,<span class="fu">max</span>(uvp_dat<span class="sc">$</span>zoo_files[[i]]<span class="sc">$</span>depth_including_offset),<span class="dv">20</span>))</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  conc_list[[i]]<span class="sc">$</span>mp <span class="ot">&lt;-</span> <span class="fu">get_bin_limtis</span>(conc_list[[i]]<span class="sc">$</span>db)<span class="sc">$</span>mp</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>With this, we can now want the integrated abundance for our four ocean zones. We’ll set up a holder shell first. Then fill it out with needed information about each cast which goes into it. We’ll reference the meta data folder a lot for this:</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>intg_abund <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">'list'</span>, <span class="dv">4</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(intg_abund) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'euphotic'</span>,<span class="st">'upper_meso'</span>,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>                       <span class="st">'lower_meso'</span>,<span class="st">'bathy'</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co">#a function I might use later</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param max_d a vector of max_depths corresponding to casts</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param depth_breaks numeric vector with zone limits</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param zone_labels character vector of names for lower limits</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>assign_zones <span class="ot">&lt;-</span> <span class="cf">function</span>(max_d, depth_breaks, zone_labels) {</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(depth_breaks) <span class="sc">!=</span> <span class="fu">length</span>(zone_labels)) {</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">'depth_breaks and zone_labels must be equal length'</span>)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  d_match <span class="ot">&lt;-</span> <span class="fu">sapply</span>(max_d, nearest, depth_breaks)</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  zones <span class="ot">&lt;-</span> zone_labels[<span class="fu">match</span>(d_match, depth_breaks)]</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(zones)</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>uvp_dat<span class="sc">$</span>meta<span class="sc">$</span>zone <span class="ot">&lt;-</span> <span class="fu">sapply</span>(uvp_dat<span class="sc">$</span>meta<span class="sc">$</span>max_d, assign_zones,</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">c</span>(<span class="dv">500</span>,<span class="dv">1200</span>,<span class="dv">4000</span>),</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>))</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(intg_abund)) {</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>  intg_abund[[i]]<span class="sc">$</span>d_lim <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">200</span>,<span class="dv">500</span>,<span class="dv">1200</span>,<span class="dv">4000</span>)[<span class="fu">c</span>(i, i<span class="sc">+</span><span class="dv">1</span>)]</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>  intg_abund[[i]] <span class="ot">&lt;-</span> <span class="fu">c</span>(intg_abund[[i]], <span class="fu">vector</span>(<span class="st">'list'</span>, <span class="dv">5</span>))</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(intg_abund[[i]]) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'d_lim'</span>,<span class="st">'Trichodesmium'</span>,<span class="st">'Rhizaria'</span>,</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>                            <span class="st">'Eumalacostraca'</span>,<span class="st">'Copepoda'</span>, <span class="st">'Chaetognatha'</span>)</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(intg_abund[[i]])) {</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>    intg_abund[[i]][[j]]<span class="sc">$</span>profile_id <span class="ot">&lt;-</span> uvp_dat<span class="sc">$</span>meta<span class="sc">$</span>profileid[<span class="fu">which</span>(uvp_dat<span class="sc">$</span>meta<span class="sc">$</span>zone <span class="sc">&gt;=</span> i)]</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we have a list shell set up to integrate abundance for each of our taxa of interest in each zone. This will be a fairly large loop since we’re iterating the process many times over. This is definitely the quick and dirty way to get things done. In the future I might want to build out functions for each of these tasks then apply them to each individual taxa</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">#ugly functions to avoid ridiculous looping</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>subset_taxa <span class="ot">&lt;-</span> <span class="cf">function</span>(df, taxa) {</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  rdf <span class="ot">&lt;-</span> df[df<span class="sc">$</span>taxa <span class="sc">==</span> taxa,]</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(rdf)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>subset_d <span class="ot">&lt;-</span> <span class="cf">function</span>(df, d_lower, d_upper) {</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  rdf <span class="ot">&lt;-</span> df[df<span class="sc">$</span>mp <span class="sc">&gt;</span> d_lower <span class="sc">&amp;</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>              df<span class="sc">$</span>mp <span class="sc">&lt;</span> d_upper, ]</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(rdf)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>org_loop <span class="ot">&lt;-</span> <span class="cf">function</span>(df, lim_list) {</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  intg <span class="ot">&lt;-</span> <span class="fu">trapz_integarate</span>(df<span class="sc">$</span>mp, df<span class="sc">$</span>conc_m3,</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>                           lim_list<span class="sc">$</span>d_lim[<span class="dv">1</span>], lim_list<span class="sc">$</span>d_lim[<span class="dv">2</span>],</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>                           <span class="at">subdivisions =</span> <span class="dv">500</span>)</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(intg<span class="sc">$</span>value)</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>nrow_check <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">nrow</span>(df) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">FALSE</span>)</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">TRUE</span>)</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(intg_abund)) {</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(intg_abund[[i]])) {</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>    temp_conc_list <span class="ot">&lt;-</span> <span class="fu">lapply</span>(conc_list, subset_taxa, <span class="fu">names</span>(intg_abund[[i]])[j])</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>    temp_conc_list <span class="ot">&lt;-</span> <span class="fu">lapply</span>(temp_conc_list, subset_d, intg_abund[[i]]<span class="sc">$</span>d_lim[<span class="dv">1</span>], intg_abund[[i]]<span class="sc">$</span>d_lim[<span class="dv">2</span>])</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>    temp_conc_list <span class="ot">&lt;-</span> temp_conc_list[<span class="fu">which</span>(<span class="fu">names</span>(temp_conc_list) <span class="sc">%in%</span> intg_abund[[i]][[j]]<span class="sc">$</span>profile_id)]</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">any</span>(<span class="sc">!</span>(<span class="fu">sapply</span>(temp_conc_list,nrow_check)))) {</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>      drop <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="sc">!</span>(<span class="fu">sapply</span>(temp_conc_list,nrow_check)))</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>      temp_conc_list <span class="ot">&lt;-</span> temp_conc_list[<span class="sc">-</span>drop]</span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>      intg_abund[[i]][[j]]<span class="sc">$</span>profile_id <span class="ot">&lt;-</span> intg_abund[[i]][[j]]<span class="sc">$</span>profile_id[<span class="sc">-</span>drop]</span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>    intg_taxa <span class="ot">&lt;-</span> <span class="fu">sapply</span>(temp_conc_list, org_loop, intg_abund[[i]])</span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>    intg_abund[[i]][[j]]<span class="sc">$</span>num_m2 <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(intg_taxa[<span class="fu">match</span>(<span class="fu">names</span>(intg_taxa),intg_abund[[i]][[j]]<span class="sc">$</span>profile_id)])</span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now we have a big set of data with integrated abundances in each four depth zone. Now all we have to do is plot them according to their latitudes. Looking at the data however, it seems that we have really limited data for Eumalacostraca and Chaetognatha. So let’s just look at Copepods, Rhizaria, and Trichodesmium.</p>
</section>
<section id="plotting-our-data" class="level3">
<h3 class="anchored" data-anchor-id="plotting-our-data">4 - Plotting our data</h3>
<p>Before we plot the data, it is nice to get everything into a clean plotting dataframe. I’m thinking that it’ll be best to plot all three taxa on panels based on the depth</p>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">#set the taxa we are intested in plotting</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>plot_taxa <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'Trichodesmium'</span>, <span class="st">'Rhizaria'</span>, <span class="st">'Copepoda'</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>mush_into_df <span class="ot">&lt;-</span> <span class="cf">function</span>(obj) {</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  rdf <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(obj[[<span class="dv">1</span>]])</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  rdf<span class="sc">$</span>taxa <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">names</span>(obj), <span class="fu">nrow</span>(rdf))</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(rdf)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>plot_list <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">'list'</span>, <span class="dv">4</span>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(plot_list) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'Euphotic'</span>, <span class="st">'Upper_Meso'</span>,<span class="st">'Lower_Meso'</span>,<span class="st">'Bathy'</span>)</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(plot_list)) {</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(intg_abund[[i]][plot_taxa])) {</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    plot_list[[i]][[j]] <span class="ot">&lt;-</span> <span class="fu">mush_into_df</span>(intg_abund[[i]][plot_taxa[j]])</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>  plot_list[[i]] <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, plot_list[[i]])</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>  plot_list[[i]] <span class="ot">&lt;-</span> <span class="fu">merge</span>(plot_list[[i]],</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">data.frame</span>(<span class="at">profile_id =</span> uvp_dat<span class="sc">$</span>meta<span class="sc">$</span>profileid,</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">lat =</span> uvp_dat<span class="sc">$</span>meta<span class="sc">$</span>latitude))</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now everything is all set up for us to plot our figures based on latitude</p>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>plot_output <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">'list'</span>, <span class="dv">4</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(plot_output)) {</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  plot_list[[i]] <span class="ot">&lt;-</span> plot_list[[i]][<span class="sc">!</span><span class="fu">is.na</span>(plot_list[[i]]<span class="sc">$</span>num_m2),]</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  plot_output[[i]] <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(plot_list[[i]],<span class="fu">aes</span>(<span class="at">y =</span> num_m2, <span class="at">x =</span> lat, <span class="at">col =</span> taxa)) <span class="sc">+</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">se =</span> F, <span class="at">method =</span> <span class="st">'loess'</span>,</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">size =</span> <span class="dv">1</span>, <span class="at">alpha =</span> .<span class="dv">05</span>, <span class="at">span =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>   <span class="fu">coord_flip</span>()<span class="sc">+</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">'Latitude'</span>, <span class="at">y =</span> <span class="st">'Integrated Abudance [Number/m2]'</span>,</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">subtitle =</span> <span class="fu">names</span>(plot_list)[i],</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">col =</span> <span class="st">""</span>)<span class="sc">+</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>   <span class="fu">theme_bw</span>()</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(plot_output)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>[[1]]</code></pre>
</div>
<div class="cell-output-stderr">
<pre><code>`geom_smooth()` using formula 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="bv57_exploratory_density_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-stdout">
<pre><code>
[[2]]</code></pre>
</div>
<div class="cell-output-stderr">
<pre><code>`geom_smooth()` using formula 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="bv57_exploratory_density_files/figure-html/unnamed-chunk-22-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-stdout">
<pre><code>
[[3]]</code></pre>
</div>
<div class="cell-output-stderr">
<pre><code>`geom_smooth()` using formula 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="bv57_exploratory_density_files/figure-html/unnamed-chunk-22-3.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-stdout">
<pre><code>
[[4]]</code></pre>
</div>
<div class="cell-output-stderr">
<pre><code>`geom_smooth()` using formula 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="bv57_exploratory_density_files/figure-html/unnamed-chunk-22-4.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Cool we have some figures to start working with. I’m saving a bit of data to and providing here. It is an RDS so to load it you just type readRDS(‘filename.rds’).</p>
<div class="cell">
<div class="sourceCode" id="cb22"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(plot_list, <span class="st">'./item01_integrated-abundances-by-zone'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>



</section>
</section>
</main> <!-- /main -->
<script type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    setTimeout(function() {
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->


</body></html>